CREATE USER stock IDENTIFIED BY stock;
Grant dba to stock;
connect stock/stock

Create table MAGASIN(
    id_magasin varchar(7) PRIMARY KEY,
    nom varchar(20)
);

CREATE SEQUENCE MAGASIN_SEQ
INCREMENT BY 1
START WITH 3
MAXVALUE 9999999
MINVALUE 1
NOCYCLE
NOCACHE
NOORDER;

Create table PRODUIT(
    id_produit varchar(7) PRIMARY KEY,
    nom varchar(20)
);

CREATE SEQUENCE PRODUIT_SEQ
INCREMENT BY 1
START WITH 5
MAXVALUE 9999999
MINVALUE 1
NOCYCLE
NOCACHE
NOORDER;

Create table Report(
    id_report varchar(7) PRIMARY KEY,
    id_produit varchar(7),
    id_magasin varchar(7),
    reste number,
    date_report VARCHAR(10)
);
CREATE SEQUENCE REPORT_SEQ
INCREMENT BY 1
START WITH 1
MAXVALUE 9999999
MINVALUE 1
NOCYCLE
NOCACHE
NOORDER;


Create table MouvementStock(
    id_mouvement_stock varchar(7) PRIMARY KEY,
    date_mouvement VARCHAR(10),
    id_magasin varchar(7),
    id_produit varchar(7),
    entree number,
    sortie number
);
CREATE SEQUENCE MouvementStock_SEQ
INCREMENT BY 1
START WITH 4
MAXVALUE 9999999
MINVALUE 1
NOCYCLE
NOCACHE
NOORDER;

CREATE TABLE PRODUITMAGASIN(
    id_magasin VARCHAR(7),
    id_produit VARCHAR(7)
);

INSERT INTO MouvementStock VALUES('MS00001','2022-12-01','M000001','P000001',10,0);
INSERT INTO MouvementStock VALUES('MS00002','2022-12-01','M000001','P000001',100,5);
INSERT INTO MouvementStock VALUES('MS00003','2022-12-01','M000001','P000002',50,0);

INSERT INTO MouvementStock VALUES('MS00004','2022-12-02','M000001','P000001',10,0);
INSERT INTO MouvementStock VALUES('MS00005','2022-12-02','M000001','P000001',100,5);
INSERT INTO MouvementStock VALUES('MS00006','2022-12-02','M000001','P000002',50,0);

INSERT INTO MouvementStock VALUES('MS00007','2022-12-01','M000002','P000003',10,0);
INSERT INTO MouvementStock VALUES('MS00008','2022-12-01','M000002','P000003',100,5);
INSERT INTO MouvementStock VALUES('MS00009','2022-12-01','M000002','P000004',50,0);

INSERT INTO MouvementStock VALUES('MS00010','2022-12-02','M000002','P000003',10,0);
INSERT INTO MouvementStock VALUES('MS00011','2022-12-02','M000002','P000003',100,5);
INSERT INTO MouvementStock VALUES('MS00012','2022-12-02','M000002','P000004',50,0);

INSERT INTO MouvementStock VALUES('MS00013','2022-12-03','M000002','P000003',10,0);
INSERT INTO MouvementStock VALUES('MS00014','2022-12-03','M000002','P000003',100,5);
INSERT INTO MouvementStock VALUES('MS00015','2022-12-03','M000002','P000004',50,0);

INSERT INTO MouvementStock VALUES('MS00016','2022-12-03','M000002','P000003',10,0);
INSERT INTO MouvementStock VALUES('MS00017','2022-12-03','M000002','P000003',100,5);
INSERT INTO MouvementStock VALUES('MS00018','2022-12-03','M000002','P000004',50,0);


SELECT ID_PRODUIT , ID_MAGASIN , SUM(ENTREE) AS ENTREE , SUM(SORTIE) AS SORTIE , SUM(ENTREE)-SUM(SORTIE) AS RESTE FROM MOUVEMENTSTOCK GROUP BY ID_MAGASIN , ID_PRODUIT ORDER BY ID_MAGASIN ASC;
SELECT ID_PRODUIT , ID_MAGASIN , SUM(ENTREE) AS ENTREE , SUM(SORTIE) AS SORTIE , SUM(ENTREE)-SUM(SORTIE) AS RESTE FROM MOUVEMENTSTOCK  WHERE DATE_MOUVEMENT<='2022-12-01' GROUP BY ID_MAGASIN , ID_PRODUIT ORDER BY ID_MAGASIN ASC;


INSERT INTO PRODUIT VALUES('P000001','P1');
INSERT INTO PRODUIT VALUES('P000002','P2');

INSERT INTO MAGASIN VALUES('M000001','M1');
INSERT INTO MAGASIN VALUES('M000002','M2');

INSERT INTO PRODUITMAGASIN VALUES('M000001','P000001');
INSERT INTO PRODUITMAGASIN VALUES('M000001','P000002');
INSERT INTO PRODUITMAGASIN VALUES('M000002','P000001');
INSERT INTO PRODUITMAGASIN VALUES('M000002','P000002');

INSERT INTO REPORT VALUES ('R1','P000001','M000001',10,'2024-10-12');

INSERT INTO REPORT VALUES ('R2','P000001','M000001',10,'2020-10-12');
INSERT INTO REPORT VALUES ('R3','P000002','M000001',100,'2020-10-12');
INSERT INTO REPORT VALUES ('R4','P000002','M000001',10,'2024-10-12');

INSERT INTO REPORT VALUES ('R2','P000001','M000001',10,'2022-11-12');
INSERT INTO REPORT VALUES ('R3','P000001','M000001',10,'2023-10-12');



CREATE VIEW ETATSTOCK AS SELECT ID_PRODUIT , ID_MAGASIN , SUM(ENTREE) AS ENTREE , SUM(SORTIE) AS SORTIE , SUM(ENTREE)-SUM(SORTIE) AS RESTE FROM MOUVEMENTSTOCK GROUP BY ID_MAGASIN , ID_PRODUIT ORDER BY ID_MAGASIN ASC;

commit;






INSERT INTO REPORT VALUES ('R3','P000001','M000001',0,'2023-01-01');
INSERT INTO REPORT VALUES ('R4','P000002','M000001',0,'2023-01-01');

INSERT INTO REPORT VALUES ('R5','P000001','M000001',279,'2023-01-06');
INSERT INTO REPORT VALUES ('R6','P000002','M000001',91,'2023-01-06');

INSERT INTO REPORT VALUES ('R7','P000001','M000001',274,'2023-01-08');
INSERT INTO REPORT VALUES ('R8','P000002','M000001',86,'2023-01-08');

INSERT INTO REPORT VALUES ('R9','P000001','M000002',0,'2023-01-01');
INSERT INTO REPORT VALUES ('R10','P000002','M000002',0,'2023-01-01');




INSERT INTO MouvementStock VALUES('MS00001','2023-01-02','M000001','P000001',100,0);
INSERT INTO MouvementStock VALUES('MS00002','2023-01-03','M000001','P000001',200,0);
INSERT INTO MouvementStock VALUES('MS00003','2023-01-04','M000001','P000001',0,20);
INSERT INTO MouvementStock VALUES('MS00004','2023-01-03','M000001','P000002',100,0);
INSERT INTO MouvementStock VALUES('MS00005','2023-01-04','M000001','P000002',0,10);
INSERT INTO MouvementStock VALUES('MS00006','2023-01-03','M000002','P000001',20,0);
INSERT INTO MouvementStock VALUES('MS00007','2023-01-03','M000002','P000001',0,3);
INSERT INTO MouvementStock VALUES('MS00008','2023-01-07','M000002','P000002',50,4);
INSERT INTO MouvementStock VALUES('MS00009','2023-01-07','M000002','P000002',0,4);
INSERT INTO MouvementStock VALUES('MS00010','2023-01-07','M000001','P000001',0,4);
INSERT INTO MouvementStock VALUES('MS00011','2023-01-07','M000001','P000002',0,4);
INSERT INTO MouvementStock VALUES('MS00012','2023-01-07','M000001','P000002',0,4);
INSERT INTO MouvementStock VALUES('MS00013','2023-01-07','M000001','P000002',0,4);
INSERT INTO MouvementStock VALUES('MS00014','2023-01-07','M000001','P000002',0,4);
INSERT INTO MouvementStock VALUES('MS00015','2023-01-10','M000001','P000002',0,4);
INSERT INTO MouvementStock VALUES('MS00016','2023-01-10','M000001','P000002',0,4);
INSERT INTO MouvementStock VALUES('MS00017','2023-01-10','M000001','P000001',0,4);
INSERT INTO MouvementStock VALUES('MS00018','2023-01-10','M000001','P000001',0,4);













